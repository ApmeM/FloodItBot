Bridge.assembly("MyONez.Samples.Base",function($asm,globals){"use strict";Bridge.define("MyONez.Samples.Base.AI.BaseFloodItAI",{inherits:[BrainAI.AI.FSM.State$1(System.Array.type(System.Int32,2))],fields:{turn:null,startX:0,startY:0},ctors:{ctor:function(turn,startX,startY){this.$initialize();BrainAI.AI.FSM.State$1(System.Array.type(System.Int32,2)).ctor.call(this);this.turn=turn;this.startX=startX;this.startY=startY}},methods:{Update:function(){if(!this.turn.TurnMade){var color=this.Act();this.Context.get([0,0])===color||this.Context.get([System.Array.getLength(this.Context,0)-1|0,System.Array.getLength(this.Context,1)-1|0])===color||color<0||color>=MyONez.Samples.Base.Screens.BasicScene.ColorsCount||(this.turn.Color=color,this.turn.TurnMade=!0)}}}});Bridge.define("MyONez.Samples.Base.Components.CounterComponent",{inherits:[LocomotorECS.Component],fields:{Player1Size:0,Player2Size:0,Player1Wins:0,Player2Wins:0,GameOver:!1,Player1Name:null,Player2Name:null}});Bridge.define("MyONez.Samples.Base.Components.FieldComponent",{inherits:[LocomotorECS.Component],fields:{Texture:null,Map:null,BlockSize:0,BlockInterval:0}});Bridge.define("MyONez.Samples.Base.Components.PlayerSwitcherComponent",{inherits:[LocomotorECS.Component],props:{Player2:null,Player1:null,Player:0}});Bridge.define("MyONez.Samples.Base.Components.TurnMadeComponent",{inherits:[LocomotorECS.Component],fields:{Player:0,Color:0,TurnMade:!1}});Bridge.define("MyONez.Samples.Base.ContentPaths",{statics:{fields:{content:null,help1:null,help2:null,help3:null,moon:null},ctors:{init:function(){this.content="Content";this.help1="help1";this.help2="help2";this.help3="help3";this.moon="moon"}}}});Bridge.define("MyONez.Samples.Base.Game1",{inherits:[MyONez.Core],ctors:{ctor:function(){this.$initialize();MyONez.Core.ctor.call(this,650,800);this.Window.AllowUserResizing=!0}},methods:{Initialize:function(){MyONez.Core.prototype.Initialize.call(this);MyONez.Core.Instance.SwitchScene(new(MyONez.AdditionalContent.Scenes.LoadingScene$1(MyONez.Samples.Base.Screens.BasicScene))(Bridge.fn.bind(this,$asm.$.MyONez.Samples.Base.Game1.f1)(new(System.Collections.Generic.List$1(MyONez.AdditionalContent.Scenes.LoadingData).ctor)),1200,600))}}});Bridge.ns("MyONez.Samples.Base.Game1",$asm.$);Bridge.apply($asm.$.MyONez.Samples.Base.Game1,{f1:function(_o1){var $t;return _o1.add(($t=new MyONez.AdditionalContent.Scenes.LoadingData,$t.Count=4,$t.Enumerator=MyONez.Samples.Base.Screens.BasicScene.GetEnumerator(this.Content),$t)),_o1.add(($t=new MyONez.AdditionalContent.Scenes.LoadingData,$t.Count=47,$t.Enumerator=GeonBit.UI.Utils.GeonBitUIResources.GetEnumerator(this.Content,"hd"),$t)),_o1}});Bridge.define("MyONez.Samples.Base.Screens.BasicScene",{inherits:[MyONez.ECS.Scene],statics:{fields:{MapSize:0,ColorsCount:0},ctors:{init:function(){this.MapSize=7;this.ColorsCount=5}},methods:{GetEnumerator:function(content){var $step=0,$jumpFromFinally,$returnValue,$async_e,$enumerator=new Bridge.GeneratorEnumerator(Bridge.fn.bind(this,function(){try{for(;;)switch($step){case 0:return content.Load(Microsoft.Xna.Framework.Graphics.Texture2D,MyONez.Samples.Base.ContentPaths.moon),$enumerator.current=Bridge.box(0,System.Int32),$step=1,!0;case 1:return content.Load(Microsoft.Xna.Framework.Graphics.Texture2D,MyONez.Samples.Base.ContentPaths.help1),$enumerator.current=Bridge.box(0,System.Int32),$step=2,!0;case 2:return content.Load(Microsoft.Xna.Framework.Graphics.Texture2D,MyONez.Samples.Base.ContentPaths.help2),$enumerator.current=Bridge.box(0,System.Int32),$step=3,!0;case 3:return content.Load(Microsoft.Xna.Framework.Graphics.Texture2D,MyONez.Samples.Base.ContentPaths.help3),$enumerator.current=Bridge.box(0,System.Int32),$step=4,!0;case 4:default:return!1}}catch($async_e1){$async_e=System.Exception.create($async_e1);throw $async_e;}}));return $enumerator}}},ctors:{ctor:function(){var $t,moonTex,common,fieldEntity,field,player1,player1Turn,player2,player2Turn,counterEntity,counter,uiEntity,ui,colorsCountLabel,colorsCountDropDown,player2Label,player2DropDown,settingsMessageBox;this.$initialize();MyONez.ECS.Scene.ctor.call(this);this.SetDesignResolution(1200,600,MyONez.Graphics.ResolutionPolicy.SceneResolutionPolicy.None);MyONez.Core.Instance.Screen.SetSize(1200,600);this.AddRenderer(MyONez.Graphics.Renderers.DefaultRenderer,new MyONez.Graphics.Renderers.DefaultRenderer);this.AddEntitySystem(new MyONez.Samples.Base.Systems.FieldMeshGeneratorSystem);this.AddEntitySystem(new MyONez.Samples.Base.Systems.FieldClickUpdateSystem(this));this.AddEntitySystem(new MyONez.Samples.Base.Systems.ApplyTurnUpdateSystem(this));this.AddEntitySystem(new MyONez.Samples.Base.Systems.CounterToTextUpdateSystem);this.AddEntitySystem(new MyONez.Samples.Base.Systems.GameOverUpdateSystem(this));this.AddEntitySystem(new GeonBit.UI.ECS.EntitySystems.TextUIUpdateSystem);this.AddEntitySystem(new BrainAI.ECS.EntitySystems.AIUpdateSystem);this.AddEntitySystem(new GeonBit.UI.ECS.EntitySystems.UIUpdateSystem(MyONez.Core.Instance.Content));this.AddEntitySystem(new MyONez.Samples.Base.Systems.TurnSelectorUpdateSystem);this.AddEntitySystem(new MyONez.Samples.Base.Systems.ColorSelectorGrayingUpdateSystem(this));this.AddEntitySystemExecutionOrder(BrainAI.ECS.EntitySystems.AIUpdateSystem,MyONez.Samples.Base.Systems.TurnSelectorUpdateSystem);this.AddEntitySystemExecutionOrder(MyONez.Samples.Base.Systems.FieldClickUpdateSystem,MyONez.Samples.Base.Systems.TurnSelectorUpdateSystem);this.AddEntitySystemExecutionOrder(MyONez.Samples.Base.Systems.TurnSelectorUpdateSystem,MyONez.Samples.Base.Systems.ApplyTurnUpdateSystem);this.AddEntitySystemExecutionOrder(MyONez.Samples.Base.Systems.ApplyTurnUpdateSystem,MyONez.Samples.Base.Systems.FieldMeshGeneratorSystem);this.AddEntitySystemExecutionOrder(MyONez.Samples.Base.Systems.ApplyTurnUpdateSystem,MyONez.Samples.Base.Systems.GameOverUpdateSystem);this.AddEntitySystemExecutionOrder(MyONez.Samples.Base.Systems.ApplyTurnUpdateSystem,MyONez.Samples.Base.Systems.CounterToTextUpdateSystem);this.AddEntitySystemExecutionOrder(MyONez.Samples.Base.Systems.ApplyTurnUpdateSystem,MyONez.Samples.Base.Systems.ColorSelectorGrayingUpdateSystem);this.AddEntitySystemExecutionOrder(MyONez.Samples.Base.Systems.ColorSelectorGrayingUpdateSystem,MyONez.Samples.Base.Systems.FieldMeshGeneratorSystem);this.AddEntitySystemExecutionOrder(MyONez.Samples.Base.Systems.CounterToTextUpdateSystem,MyONez.Samples.Base.Systems.GameOverUpdateSystem);this.AddEntitySystemExecutionOrder(MyONez.Samples.Base.Systems.CounterToTextUpdateSystem,GeonBit.UI.ECS.EntitySystems.TextUIUpdateSystem);this.AddEntitySystemExecutionOrder(GeonBit.UI.ECS.EntitySystems.UIUpdateSystem,GeonBit.UI.ECS.EntitySystems.TextUIUpdateSystem);moonTex=MyONez.Core.Instance.Content.Load(Microsoft.Xna.Framework.Graphics.Texture2D,MyONez.Samples.Base.ContentPaths.moon);common=this.CreateEntity("Common");common.AddComponent$1(MyONez.ECS.Components.CameraShakeComponent,new MyONez.ECS.Components.CameraShakeComponent(this.Camera));fieldEntity=this.CreateEntity("Field");fieldEntity.AddComponent(MyONez.ECS.Components.PositionComponent).Position=new Microsoft.Xna.Framework.Vector2.$ctor2(285,5);fieldEntity.AddComponent(MyONez.Samples.Base.Components.TurnMadeComponent);field=fieldEntity.AddComponent(MyONez.Samples.Base.Components.FieldComponent);field.BlockSize=85;field.Map=System.Array.create(0,null,System.Int32,7,7);field.Texture=moonTex;var colorSelector=this.CreateEntity("ColorSelector"),colorSelectorPosition=colorSelector.AddComponent(MyONez.ECS.Components.PositionComponent),colorSelectionField=colorSelector.AddComponent(MyONez.Samples.Base.Components.FieldComponent);colorSelectorPosition.Position=new Microsoft.Xna.Framework.Vector2.$ctor2(1e3,MyONez.Core.Instance.Screen.Center.Y-Bridge.Int.mul(Bridge.Int.div(400,MyONez.Samples.Base.Screens.BasicScene.ColorsCount)|0,MyONez.Samples.Base.Screens.BasicScene.ColorsCount)/2);colorSelectionField.Map=System.Array.create(0,null,System.Int32,1,MyONez.Samples.Base.Screens.BasicScene.ColorsCount);colorSelectionField.Texture=moonTex;colorSelectionField.BlockSize=(Bridge.Int.div(400,MyONez.Samples.Base.Screens.BasicScene.ColorsCount)|0)-10|0;colorSelectionField.BlockInterval=10;player1=this.CreateEntity("Player1");player1Turn=player1.AddComponent(MyONez.Samples.Base.Components.TurnMadeComponent);player1Turn.Player=0;player1Turn.TurnMade=!1;player2=this.CreateEntity("Player2");player2Turn=player2.AddComponent(MyONez.Samples.Base.Components.TurnMadeComponent);player2Turn.Player=1;player2Turn.TurnMade=!0;fieldEntity.AddComponent$1(MyONez.Samples.Base.Components.PlayerSwitcherComponent,($t=new MyONez.Samples.Base.Components.PlayerSwitcherComponent,$t.Player1=player1Turn,$t.Player2=player2Turn,$t));counterEntity=this.CreateEntity("Counter");counter=counterEntity.AddComponent(MyONez.Samples.Base.Components.CounterComponent);counterEntity.AddComponent(GeonBit.UI.ECS.Components.TextComponent).Text="Test text;";counterEntity.AddComponent(MyONez.ECS.Components.ColorComponent).Color=Microsoft.Xna.Framework.Color.Gray.$clone();counterEntity.AddComponent(MyONez.ECS.Components.RenderOrderComponent).Order=-1;uiEntity=this.CreateEntity("UI");ui=uiEntity.AddComponent(GeonBit.UI.ECS.Components.UIComponent);ui.UserInterface.ShowCursor=!1;var panel=ui.UserInterface.AddEntity(new GeonBit.UI.Entities.Panel.$ctor1(new Microsoft.Xna.Framework.Vector2.$ctor2(250,250),GeonBit.UI.Entities.PanelSkin.None,GeonBit.UI.Entities.Anchor.CenterLeft)),helpMessageBox=this.BuildHelpMessageBox(player1,player2),player1Label=new GeonBit.UI.Entities.Label.$ctor1("Player 1"),player1DropDown=new GeonBit.UI.Entities.DropDown.ctor;player1DropDown.AddItem("User");player1DropDown.AddItem("Easy");player1DropDown.AddItem("Med.");player1DropDown.AddItem("Hard");player1DropDown.SelectedValue="User";colorsCountLabel=new GeonBit.UI.Entities.Label.$ctor1("Colors count");colorsCountDropDown=new GeonBit.UI.Entities.DropDown.ctor;colorsCountDropDown.AddItem("4");colorsCountDropDown.AddItem("5");colorsCountDropDown.AddItem("6");colorsCountDropDown.AddItem("7");colorsCountDropDown.SelectedValue="5";player2Label=new GeonBit.UI.Entities.Label.$ctor1("Player 1");player2DropDown=new GeonBit.UI.Entities.DropDown.ctor;player2DropDown.AddItem("User");player2DropDown.AddItem("Easy");player2DropDown.AddItem("Med.");player2DropDown.AddItem("Hard");player2DropDown.SelectedValue="Hard";settingsMessageBox=GeonBit.UI.Utils.MessageBox.BuildMessageBox$1("Settings","","Set",void 0,System.Array.init([player1Label,player1DropDown,player2Label,player2DropDown,colorsCountLabel,colorsCountDropDown],GeonBit.UI.Entities.Entity));settingsMessageBox.OnDone=Bridge.fn.bind(this,function(b){player1.Enabled=!0;player2.Enabled=!0;counter.Player1Name=player1DropDown.SelectedValue;counter.Player2Name=player2DropDown.SelectedValue;MyONez.Samples.Base.Screens.BasicScene.ColorsCount=System.Int32.parse(colorsCountDropDown.SelectedValue);colorSelectorPosition.Position=new Microsoft.Xna.Framework.Vector2.$ctor2(1e3,MyONez.Core.Instance.Screen.Center.Y-Bridge.Int.mul(Bridge.Int.div(400,MyONez.Samples.Base.Screens.BasicScene.ColorsCount)|0,MyONez.Samples.Base.Screens.BasicScene.ColorsCount)/2);colorSelectionField.Map=System.Array.create(0,null,System.Int32,1,MyONez.Samples.Base.Screens.BasicScene.ColorsCount);colorSelectionField.Texture=moonTex;colorSelectionField.BlockSize=(Bridge.Int.div(400,MyONez.Samples.Base.Screens.BasicScene.ColorsCount)|0)-10|0;colorSelectionField.BlockInterval=10;this.InitPlayer(0,player1,player1Turn,player1DropDown.SelectedValue,field.Map);this.InitPlayer(1,player2,player2Turn,player2DropDown.SelectedValue,field.Map);this.Restart(field,counter)});panel.AddChild(($t=new GeonBit.UI.Entities.Button.$ctor1("Help"),$t.OnClick=function(b){helpMessageBox.Show()},$t));panel.AddChild(($t=new GeonBit.UI.Entities.Button.$ctor1("Restart"),$t.OnClick=Bridge.fn.bind(this,function(b){this.Restart(field,counter)}),$t));panel.AddChild(($t=new GeonBit.UI.Entities.Button.$ctor1("Settings"),$t.OnClick=function(b){settingsMessageBox.Show();player1.Enabled=!1;player2.Enabled=!1},$t));counter.Player1Name=player1DropDown.SelectedValue;counter.Player2Name=player2DropDown.SelectedValue;this.InitPlayer(0,player1,player1Turn,player1DropDown.SelectedValue,field.Map);this.InitPlayer(1,player2,player2Turn,player2DropDown.SelectedValue,field.Map);this.Restart(field,counter);GeonBit.UI.UserInterface.Active=ui.UserInterface;helpMessageBox.Show()}},methods:{BuildHelpMessageBox:function(player1,player2){var images=System.Array.init([MyONez.Core.Instance.Content.Load(Microsoft.Xna.Framework.Graphics.Texture2D,MyONez.Samples.Base.ContentPaths.help1),MyONez.Core.Instance.Content.Load(Microsoft.Xna.Framework.Graphics.Texture2D,MyONez.Samples.Base.ContentPaths.help2),MyONez.Core.Instance.Content.Load(Microsoft.Xna.Framework.Graphics.Texture2D,MyONez.Samples.Base.ContentPaths.help3)],Microsoft.Xna.Framework.Graphics.Texture2D),image=new GeonBit.UI.Entities.Image.$ctor1(images[System.Array.index(0,images)],new Microsoft.Xna.Framework.Vector2.$ctor2(656,500),0,GeonBit.UI.Entities.Anchor.TopCenter,void 0),button=new GeonBit.UI.Entities.Button.$ctor1("next ->",0,GeonBit.UI.Entities.Anchor.BottomCenter,new Microsoft.Xna.Framework.Vector2.$ctor2(300,50),void 0),messageBox=GeonBit.UI.Utils.MessageBox.BuildMessageBox("","",System.Array.init(0,null,GeonBit.UI.Utils.MessageBox.MsgBoxOption),System.Array.init([image,button],GeonBit.UI.Entities.Entity),new Microsoft.Xna.Framework.Vector2.$ctor2(710,600)),currentImage=0;return button.OnClick=image.OnClick=function(b){if((currentImage+1|0)===images.length){messageBox.Close();return}currentImage=currentImage+1|0;image.Texture=images[System.Array.index(currentImage,images)]},messageBox.OnDone=function(b){player1.Enabled=!0;player2.Enabled=!0},messageBox.OnShow=function(b){currentImage=0;image.Texture=images[System.Array.index(currentImage,images)];player1.Enabled=!1;player2.Enabled=!1},messageBox},InitPlayer:function(playerId,player,playerTurn,selectedValue,fieldMap){var pos=playerId===0?0:6;player.RemoveComponent$1(BrainAI.ECS.Components.AIComponent);player.RemoveComponent$1(MyONez.ECS.Components.InputMouseComponent);player.RemoveComponent$1(MyONez.ECS.Components.InputTouchComponent);switch(selectedValue){case"User":player.AddComponent(MyONez.ECS.Components.InputMouseComponent);player.AddComponent(MyONez.ECS.Components.InputTouchComponent);break;case"Easy":player.AddComponent(BrainAI.ECS.Components.AIComponent).AIBot=new(BrainAI.AI.FSM.StateMachine$1(System.Array.type(System.Int32,2)))(fieldMap,new MyONez.Samples.Base.AI.RandomFloodItAI(playerTurn,pos,pos));break;case"Med.":player.AddComponent(BrainAI.ECS.Components.AIComponent).AIBot=new(BrainAI.AI.FSM.StateMachine$1(System.Array.type(System.Int32,2)))(fieldMap,new MyONez.Samples.Base.AI.LineFloodItAI(playerTurn,pos,pos));break;case"Hard":player.AddComponent(BrainAI.ECS.Components.AIComponent).AIBot=new(BrainAI.AI.FSM.StateMachine$1(System.Array.type(System.Int32,2)))(fieldMap,new MyONez.Samples.Base.AI.GreedyFloodItAI(playerTurn,pos,pos));break}},Restart:function(field,counter){for(var y,x=0;x<System.Array.getLength(field.Map,0);x=x+1|0)for(y=0;y<System.Array.getLength(field.Map,1);y=y+1|0)field.Map.set([x,y],MyONez.Maths.Random.NextInt(MyONez.Samples.Base.Screens.BasicScene.ColorsCount));counter.GameOver=!1;counter.Player1Size=1;counter.Player2Size=1}}});Bridge.define("MyONez.Samples.Base.Systems.ApplyTurnUpdateSystem",{inherits:[LocomotorECS.EntityProcessingSystem],fields:{scene:null},ctors:{ctor:function(scene){this.$initialize();LocomotorECS.EntityProcessingSystem.ctor.call(this,(new LocomotorECS.Matching.Matcher).All([MyONez.Samples.Base.Components.FieldComponent,MyONez.Samples.Base.Components.TurnMadeComponent]));this.scene=scene}},methods:{DoAction$1:function(entity,gameTime){var counterEntity,counter;LocomotorECS.EntityProcessingSystem.prototype.DoAction$1.call(this,entity,gameTime);var map=entity.GetComponent(MyONez.Samples.Base.Components.FieldComponent),turn=entity.GetComponent(MyONez.Samples.Base.Components.TurnMadeComponent),color=turn.Color;color!==map.Map.get([0,0])&&color!==map.Map.get([System.Array.getLength(map.Map,0)-1|0,System.Array.getLength(map.Map,1)-1|0])&&(counterEntity=this.scene.FindEntity("Counter"),counter=counterEntity.GetComponent(MyONez.Samples.Base.Components.CounterComponent),turn.Player===0?(this.FloodIt(map.Map,color,0,0),counter.Player1Size=this.Calc(map.Map,0,0)):(this.FloodIt(map.Map,color,System.Array.getLength(map.Map,0)-1|0,System.Array.getLength(map.Map,1)-1|0),counter.Player2Size=this.Calc(map.Map,System.Array.getLength(map.Map,0)-1|0,System.Array.getLength(map.Map,1)-1|0)))},FloodIt:function(map,floodColor,x,y){var $t,color=map.get([x,y]),frontier=new(System.Collections.Generic.Queue$1(Microsoft.Xna.Framework.Point).ctor),visited,current,next;for(frontier.Enqueue(new Microsoft.Xna.Framework.Point.$ctor2(x,y)),visited=new(System.Collections.Generic.HashSet$1(Microsoft.Xna.Framework.Point).ctor);frontier.Count>0;){current=frontier.Dequeue().$clone();map.set([current.X,current.Y],floodColor);$t=Bridge.getEnumerator(this.GetNeighbors(current.$clone()),Microsoft.Xna.Framework.Point);try{while($t.moveNext())(next=$t.Current.$clone(),this.IsInMap(map,next.$clone()))&&map.get([next.X,next.Y])===color&&(visited.contains(next.$clone())||(frontier.Enqueue(next.$clone()),visited.add(next.$clone())))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}}},Calc:function(map,x,y){var $t,color=map.get([x,y]),result=0,frontier=new(System.Collections.Generic.Queue$1(Microsoft.Xna.Framework.Point).ctor),visited,current,next;for(frontier.Enqueue(new Microsoft.Xna.Framework.Point.$ctor2(x,y)),visited=new(System.Collections.Generic.HashSet$1(Microsoft.Xna.Framework.Point).ctor);frontier.Count>0;){current=frontier.Dequeue().$clone();$t=Bridge.getEnumerator(this.GetNeighbors(current.$clone()),Microsoft.Xna.Framework.Point);try{while($t.moveNext())(next=$t.Current.$clone(),this.IsInMap(map,next.$clone()))&&map.get([next.X,next.Y])===color&&(visited.contains(next.$clone())||(frontier.Enqueue(next.$clone()),visited.add(next.$clone()),result=result+1|0))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}}return result},IsInMap:function(map,next){return next.X>=0&&next.Y>=0&&next.X<System.Array.getLength(map,0)&&next.Y<System.Array.getLength(map,1)},GetNeighbors:function(current){return new(Bridge.GeneratorEnumerable$1(Microsoft.Xna.Framework.Point))(Bridge.fn.bind(this,function(current){var $step=0,$jumpFromFinally,$returnValue,$async_e,$enumerator=new(Bridge.GeneratorEnumerator$1(Microsoft.Xna.Framework.Point))(Bridge.fn.bind(this,function(){try{for(;;)switch($step){case 0:return $enumerator.current=new Microsoft.Xna.Framework.Point.$ctor2(current.X-1|0,current.Y),$step=1,!0;case 1:return $enumerator.current=new Microsoft.Xna.Framework.Point.$ctor2(current.X+1|0,current.Y),$step=2,!0;case 2:return $enumerator.current=new Microsoft.Xna.Framework.Point.$ctor2(current.X,current.Y-1|0),$step=3,!0;case 3:return $enumerator.current=new Microsoft.Xna.Framework.Point.$ctor2(current.X,current.Y+1|0),$step=4,!0;case 4:default:return!1}}catch($async_e1){$async_e=System.Exception.create($async_e1);throw $async_e;}}));return $enumerator},arguments))}}});Bridge.define("MyONez.Samples.Base.Systems.ColorSelectorGrayingUpdateSystem",{inherits:[LocomotorECS.EntitySystem],fields:{scene:null},ctors:{ctor:function(scene){this.$initialize();LocomotorECS.EntitySystem.ctor.call(this);this.scene=scene}},methods:{DoAction:function(gameTime){var i;LocomotorECS.EntitySystem.prototype.DoAction.call(this,gameTime);var colorSelector=this.scene.FindEntity("ColorSelector"),colorSelectorMap=colorSelector.GetComponent(MyONez.Samples.Base.Components.FieldComponent).Map,field=this.scene.FindEntity("Field"),fieldMap=field.GetComponent(MyONez.Samples.Base.Components.FieldComponent).Map;for(i=0;i<System.Array.getLength(colorSelectorMap,1);i=i+1|0)colorSelectorMap.set([0,i],i);colorSelectorMap.set([0,fieldMap.get([0,0])],-1);colorSelectorMap.set([0,fieldMap.get([System.Array.getLength(fieldMap,0)-1|0,System.Array.getLength(fieldMap,1)-1|0])],-1)}}});Bridge.define("MyONez.Samples.Base.Systems.CounterToTextUpdateSystem",{inherits:[LocomotorECS.EntityProcessingSystem],ctors:{ctor:function(){this.$initialize();LocomotorECS.EntityProcessingSystem.ctor.call(this,(new LocomotorECS.Matching.Matcher).All([GeonBit.UI.ECS.Components.TextComponent,MyONez.Samples.Base.Components.CounterComponent]))}},methods:{DoAction$1:function(entity,gameTime){LocomotorECS.EntityProcessingSystem.prototype.DoAction$1.call(this,entity,gameTime);var text=entity.GetComponent(GeonBit.UI.ECS.Components.TextComponent),counter=entity.GetComponent(MyONez.Samples.Base.Components.CounterComponent);text.Text=System.String.format("\r\nStatistic: \r\n     | {0,5} | {1,5}\r\nSize | {2,5} | {3,5}\r\nWins | {4,5} | {5,5}",counter.Player1Name,counter.Player2Name,Bridge.box(counter.Player1Size,System.Int32),Bridge.box(counter.Player2Size,System.Int32),Bridge.box(counter.Player1Wins,System.Int32),Bridge.box(counter.Player2Wins,System.Int32))}}});Bridge.define("MyONez.Samples.Base.Systems.FieldClickUpdateSystem",{inherits:[LocomotorECS.EntityProcessingSystem],fields:{scene:null},ctors:{ctor:function(scene){this.$initialize();LocomotorECS.EntityProcessingSystem.ctor.call(this,(new LocomotorECS.Matching.Matcher).All([MyONez.Samples.Base.Components.TurnMadeComponent,MyONez.ECS.Components.InputMouseComponent]));this.scene=scene}},methods:{DoAction$1:function(entity,gameTime){LocomotorECS.EntityProcessingSystem.prototype.DoAction$1.call(this,entity,gameTime);var turn=entity.GetComponent(MyONez.Samples.Base.Components.TurnMadeComponent),inputMouse=entity.GetComponent(MyONez.ECS.Components.InputMouseComponent),inputTouch=entity.GetComponent(MyONez.ECS.Components.InputTouchComponent);if((inputMouse.LeftMouseButtonPressed||inputTouch.IsConnected&&System.Linq.Enumerable.from(inputTouch.CurrentTouches).any())&&!turn.TurnMade){var cursorPosition=inputTouch.IsConnected&&System.Linq.Enumerable.from(inputTouch.CurrentTouches).any()?System.Linq.Enumerable.from(inputTouch.CurrentTouches).first().Position:inputMouse.MousePosition,fieldEntity=this.scene.FindEntity("Field"),field=fieldEntity.GetComponent(MyONez.Samples.Base.Components.FieldComponent);this.TryMakeTurn(field.Map,fieldEntity,cursorPosition.$clone(),turn)||(fieldEntity=this.scene.FindEntity("ColorSelector"),this.TryMakeTurn(field.Map,fieldEntity,cursorPosition.$clone(),turn))}},TryMakeTurn:function(fieldMap,fieldEntity,cursorPosition,turn){var position=fieldEntity.GetComponent(MyONez.ECS.Components.PositionComponent),field=fieldEntity.GetComponent(MyONez.Samples.Base.Components.FieldComponent),map=field.Map,location=Microsoft.Xna.Framework.Vector2.op_Division$1(Microsoft.Xna.Framework.Vector2.op_Subtraction(cursorPosition.$clone(),position.Position.$clone()),field.BlockSize+field.BlockInterval|0),x=Bridge.Int.clip32(Math.floor(location.X)),y=Bridge.Int.clip32(Math.floor(location.Y)),common;return this.IsInMap(map,x,y)?fieldMap.get([0,0])===map.get([x,y])||fieldMap.get([System.Array.getLength(fieldMap,0)-1|0,System.Array.getLength(fieldMap,1)-1|0])===map.get([x,y])||map.get([x,y])===-1?(common=this.scene.FindEntity("Common"),common.GetComponent(MyONez.ECS.Components.CameraShakeComponent).Shake(),!0):(turn.Color=map.get([x,y]),turn.TurnMade=!0,!0):!1},IsInMap:function(map,x,y){return x>=0&&y>=0&&x<System.Array.getLength(map,0)&&y<System.Array.getLength(map,1)}}});Bridge.define("MyONez.Samples.Base.Systems.FieldMeshGeneratorSystem",{inherits:[LocomotorECS.EntityProcessingSystem],ctors:{ctor:function(){this.$initialize();LocomotorECS.EntityProcessingSystem.ctor.call(this,(new LocomotorECS.Matching.Matcher).All([MyONez.Samples.Base.Components.FieldComponent]))}},methods:{DoAction$1:function(entity,gameTime){var $t,$t1,$t2,$t3,$t4,texture,x,y,transformation,mesh,x1,y1;LocomotorECS.EntityProcessingSystem.prototype.DoAction$1.call(this,entity,gameTime);var field=entity.GetComponent(MyONez.Samples.Base.Components.FieldComponent),finalRender=entity.GetOrCreateComponent(MyONez.ECS.Components.FinalRenderComponent),effect=($t=($t1=entity.GetComponent(MyONez.ECS.Components.SpriteEffectsComponent))!=null?$t1.SpriteEffects:null,$t!=null?$t:Microsoft.Xna.Framework.Graphics.SpriteEffects.None),depth=($t2=($t3=entity.GetComponent(MyONez.ECS.Components.DepthLayerComponent))!=null?$t3.Depth:null,$t2!=null?$t2:0);if(finalRender.Batch.Meshes.Count!==Bridge.Int.mul(System.Array.getLength(field.Map,0),System.Array.getLength(field.Map,1))){for(finalRender.Batch.Clear(),texture=field.Texture,x=0;x<System.Array.getLength(field.Map,0);x=x+1|0)for(y=0;y<System.Array.getLength(field.Map,1);y=y+1|0)finalRender.Batch.Draw(texture,new MyONez.Maths.RectangleF.$ctor2(Bridge.Int.mul(x,field.BlockSize+field.BlockInterval|0),Bridge.Int.mul(y,field.BlockSize+field.BlockInterval|0),field.BlockSize,field.BlockSize),MyONez.Maths.RectangleF.op_Implicit$1(texture.Bounds.$clone()),this.ConvertMapToColor(field.Map.get([x,y])),depth);transformation=MyONez.Maths.TransformationUtils.GetTransformation(entity).LocalTransformMatrix.$clone();$t4=Bridge.getEnumerator(finalRender.Batch.Meshes);try{while($t4.moveNext())mesh=$t4.Current,mesh.ApplyEffectToMesh(effect),mesh.ApplyTransformMesh(transformation.$clone())}finally{Bridge.is($t4,System.IDisposable)&&$t4.System$IDisposable$Dispose()}}else for(x1=0;x1<System.Array.getLength(field.Map,0);x1=x1+1|0)for(y1=0;y1<System.Array.getLength(field.Map,1);y1=y1+1|0)finalRender.Batch.Meshes.getItem(Bridge.Int.mul(x1,System.Array.getLength(field.Map,1))+y1|0).SetColor(this.ConvertMapToColor(field.Map.get([x1,y1])))},ConvertMapToColor:function(map){switch(map){case 0:return Microsoft.Xna.Framework.Color.Red.$clone();case 1:return Microsoft.Xna.Framework.Color.Orange.$clone();case 2:return Microsoft.Xna.Framework.Color.Yellow.$clone();case 3:return Microsoft.Xna.Framework.Color.Green.$clone();case 4:return Microsoft.Xna.Framework.Color.LightBlue.$clone();case 5:return Microsoft.Xna.Framework.Color.Blue.$clone();case 6:return Microsoft.Xna.Framework.Color.Magenta.$clone()}return Microsoft.Xna.Framework.Color.DimGray.$clone()}}});Bridge.define("MyONez.Samples.Base.Systems.GameOverUpdateSystem",{inherits:[LocomotorECS.EntityProcessingSystem],fields:{scene:null},ctors:{ctor:function(scene){this.$initialize();LocomotorECS.EntityProcessingSystem.ctor.call(this,(new LocomotorECS.Matching.Matcher).All([MyONez.Samples.Base.Components.CounterComponent]));this.scene=scene}},methods:{DoAction$1:function(entity,gameTime){var counter,field;(LocomotorECS.EntityProcessingSystem.prototype.DoAction$1.call(this,entity,gameTime),counter=entity.GetComponent(MyONez.Samples.Base.Components.CounterComponent),counter.GameOver)||(field=this.scene.FindEntity("Field").GetComponent(MyONez.Samples.Base.Components.FieldComponent),(counter.Player1Size>24||counter.Player2Size>24)&&this.GameOver(counter,field))},GameOver:function(counter,field){var $t;counter.Player1Size>counter.Player2Size&&(counter.Player1Wins=counter.Player1Wins+1|0);counter.Player1Size<counter.Player2Size&&(counter.Player2Wins=counter.Player2Wins+1|0);counter.GameOver=!0;MyONez.Core.Instance.SwitchScene$2(($t=new MyONez.AdditionalContent.SceneTransitions.WindTransition,$t.SceneLoadAction=Bridge.fn.bind(this,function(){return this.scene.Restart(field,counter),this.scene}),$t))}}});Bridge.define("MyONez.Samples.Base.Systems.TurnSelectorUpdateSystem",{inherits:[LocomotorECS.EntityProcessingSystem],fields:{elapsed:null},ctors:{init:function(){this.elapsed=new System.TimeSpan;this.elapsed=System.TimeSpan.zero},ctor:function(){this.$initialize();LocomotorECS.EntityProcessingSystem.ctor.call(this,(new LocomotorECS.Matching.Matcher).All([MyONez.Samples.Base.Components.TurnMadeComponent,MyONez.Samples.Base.Components.PlayerSwitcherComponent]))}},methods:{DoAction$1:function(entity,gameTime){if(LocomotorECS.EntityProcessingSystem.prototype.DoAction$1.call(this,entity,gameTime),this.elapsed=System.TimeSpan.add(this.elapsed,gameTime),!(this.elapsed.getTotalSeconds()<.5)){var turn=entity.GetComponent(MyONez.Samples.Base.Components.TurnMadeComponent),switcher=entity.GetComponent(MyONez.Samples.Base.Components.PlayerSwitcherComponent),player,playerStart;(switcher.Player===switcher.Player1.Player?(player=switcher.Player1,playerStart=switcher.Player2):(player=switcher.Player2,playerStart=switcher.Player1),player.TurnMade)&&(this.elapsed=System.TimeSpan.zero,turn.Color=player.Color,turn.Player=player.Player,switcher.Player=1-switcher.Player|0,playerStart.TurnMade=!1)}}}});Bridge.define("MyONez.Samples.Base.AI.GreedyFloodItAI",{inherits:[MyONez.Samples.Base.AI.BaseFloodItAI],fields:{copyArray:null},ctors:{ctor:function(turn,startX,startY){this.$initialize();MyONez.Samples.Base.AI.BaseFloodItAI.ctor.call(this,turn,startX,startY)}},methods:{Act:function(){for(var value,maxValue=0,maxColor=0,i=0;i<MyONez.Samples.Base.Screens.BasicScene.ColorsCount;i=i+1|0)this.Context.get([0,0])!==i&&this.Context.get([System.Array.getLength(this.Context,0)-1|0,System.Array.getLength(this.Context,1)-1|0])!==i&&(this.copyArray=this.copyArray||System.Array.create(0,null,System.Int32,System.Array.getLength(this.Context,0),System.Array.getLength(this.Context,1)),System.Array.copy(this.Context,0,this.copyArray,0,this.Context.length),this.FloodIt(this.copyArray,i),value=this.Calc(this.copyArray),maxValue<value&&(maxValue=value,maxColor=i));return maxColor},Calc:function(map){var $t,color=map.get([this.startX,this.startY]),result=0,frontier=new(System.Collections.Generic.Queue$1(Microsoft.Xna.Framework.Point).ctor),visited,current,next;for(frontier.Enqueue(new Microsoft.Xna.Framework.Point.$ctor2(this.startX,this.startY)),visited=new(System.Collections.Generic.HashSet$1(Microsoft.Xna.Framework.Point).ctor);frontier.Count>0;){current=frontier.Dequeue().$clone();$t=Bridge.getEnumerator(this.GetNeighbors(current.$clone()),Microsoft.Xna.Framework.Point);try{while($t.moveNext())(next=$t.Current.$clone(),this.IsInMap(map,next.$clone()))&&map.get([next.X,next.Y])===color&&(visited.contains(next.$clone())||(frontier.Enqueue(next.$clone()),visited.add(next.$clone()),result=result+1|0))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}}return result},FloodIt:function(map,floodColor){var $t,color=map.get([this.startX,this.startY]),frontier=new(System.Collections.Generic.Queue$1(Microsoft.Xna.Framework.Point).ctor),visited,current,next;for(frontier.Enqueue(new Microsoft.Xna.Framework.Point.$ctor2(this.startX,this.startY)),visited=new(System.Collections.Generic.HashSet$1(Microsoft.Xna.Framework.Point).ctor);frontier.Count>0;){current=frontier.Dequeue().$clone();map.set([current.X,current.Y],floodColor);$t=Bridge.getEnumerator(this.GetNeighbors(current.$clone()),Microsoft.Xna.Framework.Point);try{while($t.moveNext())(next=$t.Current.$clone(),this.IsInMap(map,next.$clone()))&&map.get([next.X,next.Y])===color&&(visited.contains(next.$clone())||(frontier.Enqueue(next.$clone()),visited.add(next.$clone())))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}}},IsInMap:function(map,next){return next.X>=0&&next.Y>=0&&next.X<System.Array.getLength(map,0)&&next.Y<System.Array.getLength(map,1)},GetNeighbors:function(current){return new(Bridge.GeneratorEnumerable$1(Microsoft.Xna.Framework.Point))(Bridge.fn.bind(this,function(current){var $step=0,$jumpFromFinally,$returnValue,$async_e,$enumerator=new(Bridge.GeneratorEnumerator$1(Microsoft.Xna.Framework.Point))(Bridge.fn.bind(this,function(){try{for(;;)switch($step){case 0:return $enumerator.current=new Microsoft.Xna.Framework.Point.$ctor2(current.X-1|0,current.Y),$step=1,!0;case 1:return $enumerator.current=new Microsoft.Xna.Framework.Point.$ctor2(current.X+1|0,current.Y),$step=2,!0;case 2:return $enumerator.current=new Microsoft.Xna.Framework.Point.$ctor2(current.X,current.Y-1|0),$step=3,!0;case 3:return $enumerator.current=new Microsoft.Xna.Framework.Point.$ctor2(current.X,current.Y+1|0),$step=4,!0;case 4:default:return!1}}catch($async_e1){$async_e=System.Exception.create($async_e1);throw $async_e;}}));return $enumerator},arguments))}}});Bridge.define("MyONez.Samples.Base.AI.LineFloodItAI",{inherits:[MyONez.Samples.Base.AI.BaseFloodItAI],ctors:{ctor:function(turn,startX,startY){this.$initialize();MyONez.Samples.Base.AI.BaseFloodItAI.ctor.call(this,turn,startX,startY)}},methods:{Act:function(){var x,y,x1,y1;if(this.startX===0&&this.startY===0){for(x=0;x<System.Array.getLength(this.Context,0);x=x+1|0)for(y=0;y<System.Array.getLength(this.Context,1);y=y+1|0)if(this.Context.get([0,0])!==this.Context.get([x,y])&&this.Context.get([System.Array.getLength(this.Context,0)-1|0,System.Array.getLength(this.Context,1)-1|0])!==this.Context.get([x,y]))return this.Context.get([x,y])}else for(x1=System.Array.getLength(this.Context,0)-1|0;x1>=0;x1=x1-1|0)for(y1=System.Array.getLength(this.Context,1)-1|0;y1>=0;y1=y1-1|0)if(this.Context.get([0,0])!==this.Context.get([x1,y1])&&this.Context.get([System.Array.getLength(this.Context,0)-1|0,System.Array.getLength(this.Context,1)-1|0])!==this.Context.get([x1,y1]))return this.Context.get([x1,y1]);return this.Context.get([0,0])}}});Bridge.define("MyONez.Samples.Base.AI.RandomFloodItAI",{inherits:[MyONez.Samples.Base.AI.BaseFloodItAI],ctors:{ctor:function(turn,startX,startY){this.$initialize();MyONez.Samples.Base.AI.BaseFloodItAI.ctor.call(this,turn,startX,startY)}},methods:{Act:function(){return MyONez.Maths.Random.NextInt(MyONez.Samples.Base.Screens.BasicScene.ColorsCount)}}})});